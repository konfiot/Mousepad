<!DOCTYPE html>
<html lang="en">
    
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">
        <title>Off Canvas Template for Bootstrap</title>
        <!-- Bootstrap core CSS -->
        <link href="../../bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link href="../../bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
        <!-- Custom styles for this template -->
        <style>
            /*
         * Style twaks
         * --------------------------------------------------
         */
            body {
                padding-top: 70px;
            }
            footer {
                padding-left: 15px;
                padding-right: 15px;
            }
            /*
         * Off Canvas
         * --------------------------------------------------
         */
            @media screen and(max-width: 768px) {
                .row-offcanvas {
                    position: relative;
                    -webkit-transition: all 0.25s ease-out;
                    -moz-transition: all 0.25s ease-out;
                    transition: all 0.25s ease-out;
                }
                .row-offcanvas-right .sidebar-offcanvas {
                    right: -50%;
                    /* 6 columns */
                }
                .row-offcanvas-left .sidebar-offcanvas {
                    left: -50%;
                    /* 6 columns */
                }
                .row-offcanvas-right.active {
                    right: 50%;
                    /* 6 columns */
                }
                .row-offcanvas-left.active {
                    left: 50%;
                    /* 6 columns */
                }
                .sidebar-offcanvas {
                    position: absolute;
                    top: 0;
                    width: 50%;
                    /* 6 columns */
                }
            }
            .actionbar {
                border-bottom: none;
                border-left: none;
                border-right: none;
                border-top-left-radius: 0;
                border-top-right-radius: 0;
                border-bottom-left-radius: 0;
                border-bottom-right-radius: 0;
            }
        </style>
    </head>
    
    <body>
        <div class="navbar navbar-fixed-top navbar-inverse" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">Mousepad</a>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="#">List</a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Recently used<b class="caret"></b></a>
                            <ul id="last_viewed" class="dropdown-menu">
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Most used<b class="caret"></b></a>
                            <ul id="most_viewed" class="dropdown-menu">
                            </ul>
                        </li>
                    </ul>
                    <form class="navbar-form navbar-left" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search">
                        </div>
                        <button type="submit" class="btn btn-default">Search</button>
                    </form>
                    <ul class="nav navbar-nav navbar-right">
                        <li class="dropdown">
                                <a id="dLabel" role="button" data-toggle="dropdown" data-target="#" href="/page.html"><i class="icon-plus"></i></a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                    <li>
                                        <a href="edit.html#note">Note</a>
                                    </li>
                                    <li>
                                        <a href="edit.html#reminder">Reminder</a>
                                    </li>
                                    <li>
                                        <a href="edit.html#checklist">Checklist</a>
                                    </li>
                                    <li>
                                        <a href="edit.html#sketch">Sketch</a>
                                    </li>
                                </ul>
                        </li>
                        <li><a href="#"><i class="icon-cog"></i></a></li>
                        <li><a href="#"><i class="icon-signout"></i></a></li>
                    </ul>
                </div>
                <!-- /.nav-collapse -->
            </div>
            <!-- /.container -->
        </div>
        <!-- /.navbar -->
        <div class="container">
            <div class="row row-offcanvas row-offcanvas-right">
                <div class="col-md-3 sidebar-offcanvas" id="sidebar" role="navigation">
                    <div class="well sidebar-nav">
                        <ul class="nav" id="tags">
                        </ul>
                    </div>
                    <!--/.well -->
                </div>
                <!--/span-->
                <div class="col-md-9">
                    <div class="row">
                        <div class="col-md-12">
                            <ol class="breadcrumb">
                                <li>
                                    <a href="#">Home</a>
                                </li>
                                <li>
                                    <a href="#">Library</a>
                                </li>
                                <li class="active">Data</li>
                            </ol>
                        </div>
                    </div>
                    <div class="row" id="list">
                    </div>
                    <!--/row-->
                </div>
                <!--/span-->
            </div>
            <!--/row-->
            <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div id="modalcontent" class="modal-content">
                        <div id="qrcode" style="text-align:center" class="modal-body"></div>
                    </div>
                    <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
            </div>
            <!-- /.modal -->
            <!-- Modal -->
            <div class="modal fade" id="delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
            aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title">Sure ?</h4>
                        </div>
                        <div class="modal-body">Are you sure to delete this note</div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button type="button" onclick="trash()" data-dismiss="modal" class="btn btn-danger">Delete</button>
                        </div>
                    </div>
                    <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
            </div>
            <!-- /.modal -->
  </div><!--/.container-->
        <!-- Bootstrap core JavaScript==================================================-
        ->
    <!-- Placed at the end of the document so the pages load faster -->
        <script src="../../bower_components/jquery/jquery.min.js"></script>
        <script src="../../bower_components/jquery.cookie/jquery.cookie.js"></script>
        <script src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="../../bower_components/jquery-qrcode/jquery.qrcode.min.js"></script>
        <script>
        var list, to_delete;
        function qrcode(id){
            $("#modal").modal("show");
            $("#qrcode").html("");
            $('#modal').on('shown.bs.modal', function () {
                $('#qrcode').qrcode({text: "http://mousepad.konfiot.c9.io/static/html/edit.html#" + id, width: parseInt($("#modalcontent").width()-50), height: parseInt($("#modalcontent").width()-50)});
                $("#modal").unbind('shown.bs.modal');
            });
        }
        
        function refresh_filters(){
            var tags = [], types = [], timestamps = [], dates_to_display = [false, false, false, false, false];
            
            for (var i in list){
                timestamps.push(list[i]["last_viewed"]);
                for (var j in list[i]["tags"]){
                    if ((tags.indexOf(list[i]["tags"][j]) === -1) && (list[i]["tags"][j] !== "")){
                        tags.push(list[i]["tags"][j]);
                    }
                }
                
                if ((types.indexOf(list[i]["type"]) === -1) && (list[i]["type"] !== "")){
                        types.push(list[i]["type"]);
                }
            }
            
            for (var i in list){
                if (list[i]["last_viewed"] - Math.round(new Date().getTime() / 1000) >= Math.round(new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate()).getTime() / 1000) - Math.round(new Date().getTime() / 1000)){
                    dates_to_display[0] = true;
                } else if (list[i]["last_viewed"] - (Math.round(new Date().getTime() / 1000)) >= Math.round(new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate()-1).getTime() / 1000) - Math.round(new Date().getTime() / 1000)){
                    dates_to_display[1] = true;
                } else if (list[i]["last_viewed"] - (Math.round(new Date().getTime() / 1000)) >= Math.round(new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate()- new Date().getDay()).getTime() / 1000) - Math.round(new Date().getTime() / 1000)){
                    dates_to_display[2] = true;
                } else if (list[i]["last_viewed"] - (Math.round(new Date().getTime() / 1000)) >= Math.round(new Date(new Date().getFullYear(), new Date().getMonth(), 0).getTime() / 1000) - Math.round(new Date().getTime() / 1000)){
                    dates_to_display[3] = true;
                } else if (list[i]["last_viewed"] - (Math.round(new Date().getTime() / 1000)) < Math.round(new Date(new Date().getFullYear(), new Date().getMonth(), 0).getTime() / 1000) - Math.round(new Date().getTime() / 1000)){
                    dates_to_display[4] = true;
                }
            }
            
            $("#tags").html("");
            $("#tags").append("<li><a href='#' onclick='filter_tags(\"\")'>All</a></li><li>Tags</li>");
            for (var i in tags){
                $("#tags").append("<li><a href='#' onclick=\"filter_tags('" + tags[i] + "')\">" + tags[i] + "</a></li>");
            }
            
            $("#tags").append("<li>Last edited</li>");
            
            for (var i in dates_to_display){
                if (dates_to_display[i]){
                    var date;
                    switch (i){
                        case '0' :
                            date = "Today";
                        break;
                        case '1' :
                            date = "Yesterday";
                        break;
                        case '2' :
                            date = "Last Week";
                        break;
                        case '3' :
                            date = "Last Month";
                        break;
                        case '4' :
                            date = "More than one month ago";
                        break;
                    }
                    $("#tags").append("<li><a href='#' onclick=\"filter_date(" + i + ")\">" + date + "</a></li>");
                }
            }
            
            $("#tags").append("<li>Type</li>");
            
            for (var i in types){
                $("#tags").append("<li style='text-transform: capitalize'><a href='#' onclick=\"filter_types('" + types[i] + "')\">" + types[i] + "</a></li>");
            }
        }
        
        function filter_tags(tag){
            $("#list").html("");
            var data = list;
            for (var i in data){
                if ((data[i]["tags"].indexOf(tag) !== -1) || (tag === "")){
                    $("#list").append('<div class="col-md-4"><div class="thumbnail" style="padding: 0px ; margin-bottom: 20px;"><h4 style="white-space: nowrap; text-overflow: ellipsis; overflow: hidden" class="caption">' + data[i]["title"] + '</h4><a href="edit.html#' + i + '" class=""><img src="http://lorempixel.com/260/260/" alt="..."></a><div class="caption" style="margin: 0; padding: 0px ;"><p class="btn-group btn-group-justified" style="margin: 0; border-left: none ; border-bottom: none;"><a class="btn btn-default btn-warning actionbar" href="#" onclick="toogle_star(\'' + i + '\')"><i id="star' + i + '" class="icon-star" style="color: ' + ((data[i]["star"]) ? "grey" : "white")  + '"></i></a><a class="btn btn-default btn-info actionbar" onclick="qrcode(\''+i+'\')" href="#"><i class="icon-qrcode"></i></a><a class="btn btn-primary btn-default actionbar" href="#"><i class="icon-folder-close"></i></a><a onclick="pop_confirmation_modal(\'' + i + '\')" class="btn btn-default btn-danger actionbar" ><i class="icon-remove"></i></a> <a class="btn btn-default btn-success actionbar" href="#"><i class="icon-plus"></i></a></p></div></div></div>');
                }
            }
        }
        
        function filter_types(type){
            $("#list").html("");
            var data = list;
            for (var i in data){
                if ((data[i]["type"] === type) || (type === "")){
                    $("#list").append('<div class="col-md-4"><div class="thumbnail" style="padding: 0px ; margin-bottom: 20px;"><h4 style="white-space: nowrap; text-overflow: ellipsis; overflow: hidden" class="caption">' + data[i]["title"] + '</h4><a href="edit.html#' + i + '" class=""><img src="http://lorempixel.com/260/260/" alt="..."></a><div class="caption" style="margin: 0; padding: 0px ;"><p class="btn-group btn-group-justified" style="margin: 0; border-left: none ; border-bottom: none;"><a class="btn btn-default btn-warning actionbar" href="#" onclick="toogle_star(\'' + i + '\')"><i id="star' + i + '" class="icon-star" style="color: ' + ((data[i]["star"]) ? "grey" : "white")  + '"></i></a><a class="btn btn-default btn-info actionbar" onclick="qrcode(\''+i+'\')" href="#"><i class="icon-qrcode"></i></a><a class="btn btn-primary btn-default actionbar" href="#"><i class="icon-folder-close"></i></a><a onclick="pop_confirmation_modal(\'' + i + '\')" class="btn btn-default btn-danger actionbar" ><i class="icon-remove"></i></a> <a class="btn btn-default btn-success actionbar" href="#"><i class="icon-plus"></i></a></p></div></div></div>');
                }
            }
        }
        
        function filter_date(date){
            $("#list").html("");
            var data = list;
            for (var i in data){
                var cat = -1;
                if (data[i]["last_viewed"] - Math.round(new Date().getTime() / 1000) >= Math.round(new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate()).getTime() / 1000) - Math.round(new Date().getTime() / 1000)){
                    cat = 0;
                } else if (data[i]["last_viewed"] - Math.round(new Date().getTime() / 1000) >= Math.round(new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate()-1).getTime() / 1000) - Math.round(new Date().getTime() / 1000)){
                    cat = 1;
                } else if (data[i]["last_viewed"] - Math.round(new Date().getTime() / 1000) >= Math.round(new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate()- new Date().getDay()).getTime() / 1000) - Math.round(new Date().getTime() / 1000)){
                    cat = 2;
                } else if (data[i]["last_viewed"] - Math.round(new Date().getTime() / 1000) >= Math.round(new Date(new Date().getFullYear(), new Date().getMonth(), 0).getTime() / 1000) - Math.round(new Date().getTime() / 1000)){
                    cat = 3;
                } else if (data[i]["last_viewed"] - Math.round(new Date().getTime() / 1000) < Math.round(new Date(new Date().getFullYear(), new Date().getMonth(), 0).getTime() / 1000) - Math.round(new Date().getTime() / 1000)){
                    cat = 4;
                } 
                
                console.log(cat);
                
                if (cat === date){
                    $("#list").append('<div class="col-md-4"><div class="thumbnail" style="padding: 0px ; margin-bottom: 20px;"><h4 style="white-space: nowrap; text-overflow: ellipsis; overflow: hidden" class="caption">' + data[i]["title"] + '</h4><a href="edit.html#' + i + '" class=""><img src="http://lorempixel.com/260/260/" alt="..."></a><div class="caption" style="margin: 0; padding: 0px ;"><p class="btn-group btn-group-justified" style="margin: 0; border-left: none ; border-bottom: none;"><a class="btn btn-default btn-warning actionbar" href="#" onclick="toogle_star(\'' + i + '\')"><i id="star' + i + '" class="icon-star" style="color: ' + ((data[i]["star"]) ? "grey" : "white")  + '"></i></a><a class="btn btn-default btn-info actionbar" onclick="qrcode(\''+i+'\')" href="#"><i class="icon-qrcode"></i></a><a class="btn btn-primary btn-default actionbar" href="#"><i class="icon-folder-close"></i></a><a onclick="pop_confirmation_modal(\'' + i + '\')" class="btn btn-default btn-danger actionbar" ><i class="icon-remove"></i></a> <a class="btn btn-default btn-success actionbar" href="#"><i class="icon-plus"></i></a></p></div></div></div>');
                }
            }
        }
        
        function toogle_star(id){
            var star;
            if (list[id]["star"] === true){
                list[id]["star"] = false;
                star = false;
                $("#star" + id).css("color", "white");
            } else {
                list[id]["star"] = true;
                star = true;
                $("#star" + id).css("color", "grey");
            }
            $.post("/app/api/mod.php", {data: JSON.stringify({id: id, star: star})}, function(data){}, "json");

        }
        
        function pop_confirmation_modal(id){
            $("#delete").modal('show');
            to_delete = id;
        }
        
        
        function init(){
            $.post("/app/api/list.php", function(data){
                list = data;
                filter_tags("");
                refresh_filters();
                refresh_shortcuts();
            }, "json");
        }
        
        function trash(){
            $.post("/app/api/remove.php", {data: JSON.stringify({id: to_delete})}, function(data){
                init();
            }, "json");
            to_delete = "";
        }
        
        function refresh_shortcuts(){
            var max_keys = [], max_keys_last = [], max_val = 0, max_key, max_val_last = 0, max_key_last;
            for (var i = 0 ; i < 5 ; i++){
                for (var j in list){
                    if ((list[j]["times_viewed"] > max_val) && (max_keys.indexOf(j) === -1)){
                        max_key = j;
                        max_val = list[j]["times_viewed"];
                    }
                    
                    if ((list[j]["last_viewed"] > max_val_last) && (max_keys_last.indexOf(j) === -1)){
                        max_key_last = j;
                        max_val_last = list[j]["last_viewed"];
                    }
                }
                
                if(max_key !== max_keys[max_keys.length-1]){
                    max_keys.push(max_key);
                }
                max_val = 0;
                
                if(max_key_last !== max_keys_last[max_keys_last.length-1]){
                    max_keys_last.push(max_key_last);
                }
                max_val_last = 0;
            }

            $("#most_viewed").html("");
            $("#last_viewed").html("");
            
            for (var i in max_keys){
                $("#most_viewed").append("<li><a href='edit.html#" + max_keys[i] + "'>" + list[max_keys[i]]["title"] + "</a></li>");
            }
            

            for (var i in max_keys_last){
                $("#last_viewed").append("<li><a href='edit.html#" + max_keys_last[i] + "'>" + list[max_keys_last[i]]["title"] + "</a></li>");
            }
            
        }
        
        $(function(){
            init();
        });
        </script>
    </body>

</html>
